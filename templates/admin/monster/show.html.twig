{% extends 'base_admin.html.twig' %}

{% block header_title %}{{ monster.name }}{% endblock %}

{% block body %}
<div class="max-w-4xl mx-auto">
    {# Header Actions #}
    <div class="mb-6 flex items-center justify-between">
        <a href="{{ path('admin_monster_index') }}" class="text-slate-400 hover:text-primary transition-colors flex items-center space-x-2 text-sm font-bold uppercase tracking-widest">
            {{ ux_icon('lucide:arrow-left', {class: 'w-4 h-4'}) }}
            <span>Voltar para Lista</span>
        </a>
        <div class="flex items-center space-x-3">
            <a href="{{ path('admin_monster_edit', {'id': monster.id}) }}" class="px-4 py-2 bg-primary text-white rounded-xl font-semibold hover:bg-primary/90 transition-all flex items-center space-x-2">
                {{ ux_icon('lucide:edit-3', {class: 'w-4 h-4'}) }}
                <span>Editar</span>
            </a>
        </div>
    </div>

    {# Monster Image #}
    {% if image_url %}
    <div class="mb-6">
        <img src="{{ image_url }}" alt="{{ monster.name }}" class="w-full h-96 object-cover rounded-3xl shadow-2xl border-4 border-amber-900 dark:border-amber-700">
        <p class="text-xs text-slate-400 mt-2 text-center">Imagem ilustrativa via Unsplash</p>
    </div>
    {% endif %}

    {# D&D Stat Block #}
    <div class="bg-gradient-to-br from-amber-50 to-orange-50 dark:from-slate-800 dark:to-slate-900 rounded-3xl border-4 border-amber-900 dark:border-amber-700 shadow-2xl overflow-hidden">
        {# Header #}
        <div class="bg-gradient-to-r from-amber-900 to-orange-900 dark:from-amber-800 dark:to-orange-800 px-8 py-6 border-b-4 border-amber-950">
            <h1 class="text-4xl font-bold text-amber-50 mb-2 font-serif">{{ monster.name }}</h1>
            <p class="text-amber-200 text-lg italic">
                {{ monster.size }} {{ monster.type }}{% if monster.subtype %} ({{ monster.subtype }}){% endif %}{% if monster.alignment %}, {{ monster.alignment }}{% endif %}
            </p>
            {% if monster.group %}
            <p class="text-amber-300/80 text-sm mt-1 uppercase tracking-wider font-bold">{{ monster.group }}</p>
            {% endif %}
        </div>

        <div class="px-8 py-6 space-y-6">
            {# Core Stats Bar #}
            <div class="flex items-center justify-between pb-4 border-b-2 border-amber-900/30 dark:border-amber-700/30">
                <div class="text-center">
                    <div class="text-xs font-bold uppercase tracking-wider text-amber-900 dark:text-amber-300 mb-1">
                        <span data-controller="tooltip" data-tooltip-text-value="Armor Class: Dificuldade para acertar o monstro" data-action="mouseenter->tooltip#show mouseleave->tooltip#hide">Classe de Armadura</span>
                    </div>
                    <div class="text-3xl font-bold text-amber-950 dark:text-amber-100">{{ monster.armorClass ?? '—' }}</div>
                </div>
                <div class="text-center">
                    <div class="text-xs font-bold uppercase tracking-wider text-amber-900 dark:text-amber-300 mb-1">
                        <span data-controller="tooltip" data-tooltip-text-value="Hit Points: Pontos de vida do monstro" data-action="mouseenter->tooltip#show mouseleave->tooltip#hide">Pontos de Vida</span>
                    </div>
                    <div class="text-3xl font-bold text-red-700 dark:text-red-400">{{ monster.hitPoints ?? '—' }}</div>
                    {% if monster.hitDice %}
                    <div class="text-sm text-amber-700 dark:text-amber-400">({{ monster.hitDice }})</div>
                    {% endif %}
                </div>
                <div class="text-center">
                    <div class="text-xs font-bold uppercase tracking-wider text-amber-900 dark:text-amber-300 mb-1">
                        <span data-controller="tooltip" data-tooltip-text-value="Challenge Rating: Nível de desafio para encontros" data-action="mouseenter->tooltip#show mouseleave->tooltip#hide">Nível de Desafio</span>
                    </div>
                    <div class="text-3xl font-bold text-purple-700 dark:text-purple-400">{{ monster.challengeRating ?? '—' }}</div>
                </div>
            </div>

            {# Ability Scores #}
            <div class="grid grid-cols-6 gap-3 pb-4 border-b-2 border-amber-900/30 dark:border-amber-700/30">
                {% set abilities = {
                    'FOR': monster.strength,
                    'DES': monster.dexterity,
                    'CON': monster.constitution,
                    'INT': monster.intelligence,
                    'SAB': monster.wisdom,
                    'CAR': monster.charisma
                } %}
                {% for name, value in abilities %}
                <div class="text-center bg-white/50 dark:bg-slate-800/50 rounded-xl p-3 border-2 border-amber-900/20 dark:border-amber-700/20">
                    <div class="text-xs font-bold uppercase text-amber-900 dark:text-amber-300">{{ name }}</div>
                    <div class="text-2xl font-bold text-amber-950 dark:text-amber-100">{{ value ?? '—' }}</div>
                    {% if value %}
                    <div class="text-xs text-amber-700 dark:text-amber-400">({{ ((value - 10) / 2)|round(0, 'floor') >= 0 ? '+' : '' }}{{ ((value - 10) / 2)|round(0, 'floor') }})</div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>

            {# Saving Throws #}
            {% set saves = {
                'Str': monster.strengthSave,
                'Dex': monster.dexteritySave,
                'Con': monster.constitutionSave,
                'Int': monster.intelligenceSave,
                'Wis': monster.wisdomSave,
                'Cha': monster.charismaSave
            } %}
            {% set has_saves = false %}
            {% for k, v in saves %}{% if v is not null %}{% set has_saves = true %}{% endif %}{% endfor %}
            
            {% if has_saves %}
            <div class="flex flex-wrap gap-x-4 gap-y-2 text-sm pb-4 border-b-2 border-amber-900/30 dark:border-amber-700/30">
                <span class="font-bold text-amber-900 dark:text-amber-300">Testes de Resistência:</span>
                {% for k, v in saves %}
                    {% if v is not null %}
                        <span class="text-amber-950 dark:text-amber-100 font-medium">{{ k }} {{ v >= 0 ? '+' : '' }}{{ v }}</span>
                    {% endif %}
                {% endfor %}
            </div>
            {% endif %}

            {# Skills & Speed #}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pb-4 border-b-2 border-amber-900/30 dark:border-amber-700/30">
                {# Skills #}
                {% if monster.skillsJson %}
                <div>
                     <span class="font-bold text-amber-900 dark:text-amber-300 block mb-1">Perícias:</span>
                     <div class="flex flex-wrap gap-2">
                        {% for skill, val in monster.skillsJson %}
                            <span class="text-amber-950 dark:text-amber-100 capitalize">{{ skill }} {{ val >= 0 ? '+' : '' }}{{ val }}</span>{% if not loop.last %}, {% endif %}
                        {% endfor %}
                     </div>
                </div>
                {% endif %}
                
                {# Speed #}
                {% if monster.speedJson %}
                <div>
                     <span class="font-bold text-amber-900 dark:text-amber-300 block mb-1">Deslocamento:</span>
                     <div class="flex flex-wrap gap-2">
                        {% for type, val in monster.speedJson %}
                            <span class="text-amber-950 dark:text-amber-100 capitalize">
                            {% if type == 'walk' %}Caminhada{% else %}{{ type }}{% endif %} {{ val }} ft.
                            </span>{% if not loop.last %}, {% endif %}
                        {% endfor %}
                     </div>
                </div>
                {% endif %}
            </div>

            {# Additional Stats #}
            <div class="space-y-3 text-sm pb-4 border-b-2 border-amber-900/30 dark:border-amber-700/30">
                {% if monster.senses %}
                <div class="flex">
                    <span class="font-bold text-amber-900 dark:text-amber-300 min-w-[120px]">Sentidos:</span>
                    <span class="text-amber-950 dark:text-amber-100">{{ monster.senses }}</span>
                </div>
                {% endif %}
                {% if monster.languages %}
                <div class="flex">
                    <span class="font-bold text-amber-900 dark:text-amber-300 min-w-[120px]">Idiomas:</span>
                    <span class="text-amber-950 dark:text-amber-100">{{ monster.languages }}</span>
                </div>
                {% endif %}
                {% if monster.damageImmunities %}
                <div class="flex">
                    <span class="font-bold text-amber-900 dark:text-amber-300 min-w-[120px]">Imunidades:</span>
                    <span class="text-amber-950 dark:text-amber-100">{{ monster.damageImmunities }}</span>
                </div>
                {% endif %}
                {% if monster.damageResistances %}
                <div class="flex">
                    <span class="font-bold text-amber-900 dark:text-amber-300 min-w-[120px]">Resistências:</span>
                    <span class="text-amber-950 dark:text-amber-100">{{ monster.damageResistances }}</span>
                </div>
                {% endif %}
                {% if monster.damageVulnerabilities %}
                <div class="flex">
                    <span class="font-bold text-amber-900 dark:text-amber-300 min-w-[120px]">Vulnerabilidades:</span>
                    <span class="text-amber-950 dark:text-amber-100">{{ monster.damageVulnerabilities }}</span>
                </div>
                {% endif %}
                {% if monster.conditionImmunities %}
                <div class="flex">
                    <span class="font-bold text-amber-900 dark:text-amber-300 min-w-[120px]">Imun. Condições:</span>
                    <span class="text-amber-950 dark:text-amber-100">{{ monster.conditionImmunities }}</span>
                </div>
                {% endif %}
            </div>

            {# Description #}
            {% if monster.descriptionMd %}
            <div class="prose prose-amber dark:prose-invert max-w-none">
                <div class="text-amber-950 dark:text-amber-100 leading-relaxed">
                    {{ monster.descriptionMd|markdown_to_html|raw }}
                </div>
            </div>
            {% endif %}

            <div class="space-y-6 pt-4">
                {# Special Abilities #}
                {% if monster.specialAbilitiesJson %}
                    <div class="space-y-4">
                        {% for ability in monster.specialAbilitiesJson %}
                            <div class="text-amber-950 dark:text-amber-100">
                                <span class="font-bold italic text-amber-900 dark:text-amber-300">{{ ability.name }}.</span>
                                {{ ability.desc }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}

                {# Actions #}
                {% if monster.actionsJson %}
                    <div>
                        <h2 class="text-2xl font-serif font-bold text-amber-900 dark:text-amber-300 border-b-2 border-amber-900/20 mb-4 pb-1">Ações</h2>
                        <div class="space-y-4">
                            {% for action in monster.actionsJson %}
                                <div class="text-amber-950 dark:text-amber-100">
                                    <span class="font-bold italic text-amber-900 dark:text-amber-300">{{ action.name }}.</span>
                                    {{ action.desc }}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}

                {# Bonus Actions #}
                {% if monster.bonusActionsJson %}
                    <div>
                        <h2 class="text-2xl font-serif font-bold text-amber-900 dark:text-amber-300 border-b-2 border-amber-900/20 mb-4 pb-1">Ações Bônus</h2>
                        <div class="space-y-4">
                            {% for action in monster.bonusActionsJson %}
                                <div class="text-amber-950 dark:text-amber-100">
                                    <span class="font-bold italic text-amber-900 dark:text-amber-300">{{ action.name }}.</span>
                                    {{ action.desc }}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}

                {# Reactions #}
                {% if monster.reactionsJson %}
                    <div>
                        <h2 class="text-2xl font-serif font-bold text-amber-900 dark:text-amber-300 border-b-2 border-amber-900/20 mb-4 pb-1">Reações</h2>
                        <div class="space-y-4">
                            {% for action in monster.reactionsJson %}
                                <div class="text-amber-950 dark:text-amber-100">
                                    <span class="font-bold italic text-amber-900 dark:text-amber-300">{{ action.name }}.</span>
                                    {{ action.desc }}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
                
                {# Legendary Actions Loop (if array exists) #}
                {% if monster.legendaryActionsJson %}
                    <div>
                        <h2 class="text-2xl font-serif font-bold text-purple-900 dark:text-purple-300 border-b-2 border-purple-900/20 mb-4 pb-1">Ações Lendárias</h2>
                        {% if monster.legendaryDesc %}
                            <p class="mb-4 text-purple-950 dark:text-purple-100">{{ monster.legendaryDesc }}</p>
                        {% endif %}
                        <div class="space-y-4">
                            {% for action in monster.legendaryActionsJson %}
                                <div class="text-purple-950 dark:text-purple-100">
                                    <span class="font-bold italic text-purple-900 dark:text-purple-300">{{ action.name }}.</span>
                                    {{ action.desc }}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            </div>

            {# Legendary Description #}
            {% if monster.legendaryDesc %}
            <div class="mt-6 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-xl border-2 border-purple-300 dark:border-purple-700">
                <h3 class="text-lg font-bold text-purple-900 dark:text-purple-300 mb-2 flex items-center space-x-2">
                    {{ ux_icon('lucide:crown', {class: 'w-5 h-5'}) }}
                    <span>Ações Lendárias</span>
                </h3>
                <div class="text-purple-950 dark:text-purple-100">{{ monster.legendaryDesc }}</div>
            </div>
            {% endif %}
        </div>

        {# Footer #}
        <div class="bg-gradient-to-r from-amber-900 to-orange-900 dark:from-amber-800 dark:to-orange-800 px-8 py-4 border-t-4 border-amber-950">
            <div class="flex items-center justify-between text-amber-200 text-sm">
                <span>Fonte: {{ monster.rulesSource.name }}</span>
                <span class="font-mono">{{ monster.ruleSlug }}</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}
